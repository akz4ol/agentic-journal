---
layout: default
title: Submission Portal
---

<div class="portal-container">
  <div class="portal-header">
    <h1>Paper Submission Portal</h1>
    <p>Submit your research for AI-powered peer review</p>
  </div>

  <!-- Login Section -->
  <div id="auth-section" class="auth-section">
    <div class="login-box">
      <h2>Sign In to Submit</h2>
      <p>Connect with GitHub to submit papers and track your reviews.</p>
      <button id="github-login" class="btn btn-github">
        <svg height="20" width="20" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
        </svg>
        Sign in with GitHub
      </button>
    </div>
  </div>

  <!-- Submission Form (hidden until logged in) -->
  <div id="submission-section" class="submission-section" style="display: none;">
    <div class="user-info">
      <img id="user-avatar" src="" alt="Avatar" class="avatar">
      <span id="user-name"></span>
      <button id="logout-btn" class="btn btn-small">Sign Out</button>
    </div>

    <form id="submission-form" class="submission-form">
      <div class="form-section">
        <h3>Paper Details</h3>

        <div class="form-group">
          <label for="title">Paper Title *</label>
          <input type="text" id="title" name="title" required placeholder="Enter your paper title">
        </div>

        <div class="form-group">
          <label for="paper_type">Paper Type *</label>
          <select id="paper_type" name="paper_type" required>
            <option value="">Select type...</option>
            <option value="research">Research Paper</option>
            <option value="technical">Technical Report</option>
            <option value="survey">Survey Article</option>
            <option value="position">Position Paper</option>
          </select>
        </div>

        <div class="form-group">
          <label for="abstract">Abstract * (150-300 words)</label>
          <textarea id="abstract" name="abstract" required rows="6"
                    placeholder="Provide a clear summary of your research..."></textarea>
          <span class="word-count">Words: <span id="abstract-count">0</span>/300</span>
        </div>

        <div class="form-group">
          <label for="keywords">Keywords * (comma-separated)</label>
          <input type="text" id="keywords" name="keywords" required
                 placeholder="e.g., machine learning, neural networks, NLP">
        </div>
      </div>

      <div class="form-section">
        <h3>Authors</h3>
        <div id="authors-container">
          <div class="author-entry">
            <input type="text" name="author_name_1" placeholder="Name *" required>
            <input type="email" name="author_email_1" placeholder="Email *" required>
            <input type="text" name="author_affiliation_1" placeholder="Affiliation">
          </div>
        </div>
        <button type="button" id="add-author" class="btn btn-small">+ Add Author</button>
      </div>

      <div class="form-section">
        <h3>Manuscript Upload</h3>
        <div class="form-group">
          <label for="pdf">Paper PDF * (max 50MB)</label>
          <div class="file-upload" id="file-upload-zone">
            <input type="file" id="pdf" name="pdf" accept=".pdf" required>
            <div class="file-upload-text">
              <span class="upload-icon">ðŸ“„</span>
              <span>Drop PDF here or click to browse</span>
            </div>
            <div id="file-info" class="file-info"></div>
          </div>
          <div id="upload-progress" class="upload-progress" style="display: none;">
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
            <span id="progress-text">Uploading... 0%</span>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3>Optional Information</h3>

        <div class="form-group">
          <label for="code_url">Code Repository URL</label>
          <input type="url" id="code_url" name="code_url" placeholder="https://github.com/...">
        </div>

        <div class="form-group">
          <label for="data_url">Data URL</label>
          <input type="url" id="data_url" name="data_url" placeholder="https://...">
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="confirm_original" required>
            I confirm this work is original and not under review elsewhere *
          </label>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="accept_terms" required>
            I accept the <a href="/agentic-journal/about/terms/" target="_blank">Terms of Service</a> *
          </label>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" id="submit-btn" class="btn btn-primary btn-large">
          Submit for Review
        </button>
      </div>
    </form>

    <div id="submission-status" class="submission-status" style="display: none;">
      <div class="status-content">
        <div class="spinner"></div>
        <p id="status-message">Uploading your submission...</p>
      </div>
    </div>

    <div id="submission-success" class="submission-success" style="display: none;">
      <div class="success-content">
        <span class="success-icon">âœ“</span>
        <h3>Submission Received!</h3>
        <p>Your paper has been submitted for review.</p>
        <p><strong>Submission ID:</strong> <span id="submission-id"></span></p>
        <p>You will receive review results within 24-48 hours.</p>
        <a href="/agentic-journal/dashboard/" class="btn btn-primary">View Dashboard</a>
      </div>
    </div>
  </div>
</div>

<style>
.portal-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
}

.portal-header {
  text-align: center;
  margin-bottom: 2rem;
}

.portal-header h1 {
  color: var(--primary);
  margin-bottom: 0.5rem;
}

.auth-section {
  text-align: center;
  padding: 3rem;
}

.login-box {
  background: #f8f9fa;
  border-radius: 12px;
  padding: 3rem;
  max-width: 400px;
  margin: 0 auto;
}

.btn-github {
  background: #24292e;
  color: white;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  font-size: 1rem;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  transition: background 0.2s;
}

.btn-github:hover {
  background: #1a1e22;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 8px;
  margin-bottom: 2rem;
}

.avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
}

.submission-form {
  background: white;
  border: 1px solid #e0e0e0;
  border-radius: 12px;
  padding: 2rem;
}

.form-section {
  margin-bottom: 2rem;
  padding-bottom: 2rem;
  border-bottom: 1px solid #eee;
}

.form-section:last-child {
  border-bottom: none;
  margin-bottom: 0;
}

.form-section h3 {
  color: var(--primary);
  margin-bottom: 1rem;
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.form-group input[type="text"],
.form-group input[type="email"],
.form-group input[type="url"],
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 1rem;
  font-family: inherit;
}

.form-group textarea {
  resize: vertical;
}

.word-count {
  font-size: 0.85rem;
  color: #666;
  text-align: right;
  display: block;
  margin-top: 0.25rem;
}

.author-entry {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.file-upload {
  border: 2px dashed #ddd;
  border-radius: 8px;
  padding: 2rem;
  text-align: center;
  cursor: pointer;
  transition: border-color 0.2s, background-color 0.2s;
  position: relative;
}

.file-upload:hover,
.file-upload.dragover {
  border-color: var(--primary);
  background-color: #f8f9ff;
}

.file-upload.has-file {
  border-color: #28a745;
  background-color: #f8fff8;
}

.file-upload input[type="file"] {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
}

.upload-icon {
  font-size: 2rem;
  display: block;
  margin-bottom: 0.5rem;
}

.file-info {
  margin-top: 1rem;
  color: var(--primary);
  font-weight: 500;
}

.upload-progress {
  margin-top: 1rem;
}

.progress-bar {
  height: 8px;
  background: #e0e0e0;
  border-radius: 4px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), #4f46e5);
  width: 0%;
  transition: width 0.3s ease;
}

#progress-text {
  font-size: 0.85rem;
  color: #666;
  display: block;
  margin-top: 0.5rem;
}

.form-actions {
  text-align: center;
  margin-top: 2rem;
}

.btn {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: all 0.2s;
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover:not(:disabled) {
  opacity: 0.9;
}

.btn-large {
  padding: 1rem 2rem;
  font-size: 1.1rem;
}

.btn-small {
  padding: 0.25rem 0.75rem;
  font-size: 0.85rem;
  background: #eee;
}

.submission-status,
.submission-success {
  text-align: center;
  padding: 3rem;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 3px solid #f3f3f3;
  border-top: 3px solid var(--primary);
  border-radius: 50%;
  margin: 0 auto 1rem;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.success-icon {
  display: inline-block;
  width: 60px;
  height: 60px;
  background: #28a745;
  color: white;
  border-radius: 50%;
  font-size: 2rem;
  line-height: 60px;
  margin-bottom: 1rem;
}

.status-steps {
  text-align: left;
  max-width: 400px;
  margin: 1.5rem auto;
}

.status-step {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.5rem 0;
  color: #666;
}

.status-step.active {
  color: var(--primary);
  font-weight: 500;
}

.status-step.completed {
  color: #28a745;
}

.status-step .step-icon {
  width: 24px;
  text-align: center;
}

@media (max-width: 600px) {
  .author-entry {
    grid-template-columns: 1fr;
  }
}
</style>

<script>
// Configuration
const CLIENT_ID = 'Ov23ligEG9UfAYdEHRJO';
const REDIRECT_URI = window.location.origin + '/agentic-journal/portal/callback/';
const REPO_OWNER = 'akz4ol';
const REPO_NAME = 'agentic-journal';
const PDF_WORKER_URL = 'https://agentic-journal-pdf.blog-mot2gmob.workers.dev';

// State
let selectedFile = null;

// Check for existing session
document.addEventListener('DOMContentLoaded', function() {
  const token = localStorage.getItem('github_token');
  const user = JSON.parse(localStorage.getItem('github_user') || 'null');

  if (token && user) {
    showSubmissionForm(user);
  }

  setupEventListeners();
  setupDragDrop();
});

function setupEventListeners() {
  // GitHub Login
  document.getElementById('github-login').addEventListener('click', function() {
    const authUrl = `https://github.com/login/oauth/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=repo`;
    window.location.href = authUrl;
  });

  // Logout
  document.getElementById('logout-btn').addEventListener('click', function() {
    localStorage.removeItem('github_token');
    localStorage.removeItem('github_user');
    location.reload();
  });

  // Abstract word count
  document.getElementById('abstract').addEventListener('input', function() {
    const words = this.value.trim().split(/\s+/).filter(w => w).length;
    document.getElementById('abstract-count').textContent = words;

    if (words < 150 || words > 300) {
      this.style.borderColor = '#dc3545';
    } else {
      this.style.borderColor = '#28a745';
    }
  });

  // Add author
  let authorCount = 1;
  document.getElementById('add-author').addEventListener('click', function() {
    authorCount++;
    const container = document.getElementById('authors-container');
    const entry = document.createElement('div');
    entry.className = 'author-entry';
    entry.innerHTML = `
      <input type="text" name="author_name_${authorCount}" placeholder="Name">
      <input type="email" name="author_email_${authorCount}" placeholder="Email">
      <input type="text" name="author_affiliation_${authorCount}" placeholder="Affiliation">
    `;
    container.appendChild(entry);
  });

  // File selection
  document.getElementById('pdf').addEventListener('change', function() {
    handleFileSelect(this.files[0]);
  });

  // Form submission
  document.getElementById('submission-form').addEventListener('submit', handleSubmission);
}

function setupDragDrop() {
  const zone = document.getElementById('file-upload-zone');

  zone.addEventListener('dragover', (e) => {
    e.preventDefault();
    zone.classList.add('dragover');
  });

  zone.addEventListener('dragleave', () => {
    zone.classList.remove('dragover');
  });

  zone.addEventListener('drop', (e) => {
    e.preventDefault();
    zone.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      handleFileSelect(files[0]);
    }
  });
}

function handleFileSelect(file) {
  if (!file) return;

  if (!file.name.toLowerCase().endsWith('.pdf')) {
    alert('Please select a PDF file');
    return;
  }

  if (file.size > 50 * 1024 * 1024) {
    alert('File too large. Maximum size is 50MB.');
    return;
  }

  selectedFile = file;
  const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
  document.getElementById('file-info').textContent = `${file.name} (${sizeMB} MB)`;
  document.getElementById('file-upload-zone').classList.add('has-file');
}

function showSubmissionForm(user) {
  document.getElementById('auth-section').style.display = 'none';
  document.getElementById('submission-section').style.display = 'block';
  document.getElementById('user-avatar').src = user.avatar_url;
  document.getElementById('user-name').textContent = user.login;
}

function updateProgress(percent, message) {
  document.getElementById('progress-fill').style.width = percent + '%';
  document.getElementById('progress-text').textContent = message || `Uploading... ${percent}%`;
}

function showStatus(message, steps) {
  document.getElementById('submission-form').style.display = 'none';
  document.getElementById('submission-status').style.display = 'block';

  let stepsHtml = '';
  if (steps) {
    stepsHtml = '<div class="status-steps">' +
      steps.map((step, i) => {
        let className = 'status-step';
        let icon = 'â—‹';
        if (step.completed) {
          className += ' completed';
          icon = 'âœ“';
        } else if (step.active) {
          className += ' active';
          icon = 'â—‰';
        }
        return `<div class="${className}"><span class="step-icon">${icon}</span>${step.text}</div>`;
      }).join('') +
      '</div>';
  }

  document.getElementById('status-message').innerHTML = `<p>${message}</p>${stepsHtml}`;
}

async function handleSubmission(e) {
  e.preventDefault();

  if (!selectedFile) {
    alert('Please select a PDF file to upload');
    return;
  }

  const form = e.target;
  const formData = new FormData(form);
  const token = localStorage.getItem('github_token');

  // Generate submission ID
  const submissionId = `AJ-${new Date().getFullYear()}-${Date.now().toString(36).toUpperCase()}`;

  // Collect metadata
  const metadata = {
    title: formData.get('title'),
    paper_type: formData.get('paper_type'),
    abstract: formData.get('abstract'),
    keywords: formData.get('keywords').split(',').map(k => k.trim()),
    code_url: formData.get('code_url') || '',
    data_url: formData.get('data_url') || '',
    authors: []
  };

  // Collect authors
  let i = 1;
  while (formData.get(`author_name_${i}`)) {
    if (formData.get(`author_name_${i}`).trim()) {
      metadata.authors.push({
        name: formData.get(`author_name_${i}`),
        email: formData.get(`author_email_${i}`),
        affiliation: formData.get(`author_affiliation_${i}`) || ''
      });
    }
    i++;
  }

  // Disable submit button
  document.getElementById('submit-btn').disabled = true;
  document.getElementById('upload-progress').style.display = 'block';

  try {
    // Step 1: Get presigned upload URL
    updateProgress(10, 'Preparing upload...');

    const presignResponse = await fetch(`${PDF_WORKER_URL}/presign`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        submissionId,
        filename: selectedFile.name,
        contentType: 'application/pdf',
        fileSize: selectedFile.size,
        githubToken: token
      })
    });

    if (!presignResponse.ok) {
      const error = await presignResponse.json();
      throw new Error(error.error || 'Failed to prepare upload');
    }

    const { uploadUrl, key, uploadToken } = await presignResponse.json();

    // Step 2: Upload PDF
    showStatus('Uploading your paper...', [
      { text: 'Preparing upload', completed: true },
      { text: 'Uploading PDF', active: true },
      { text: 'Creating submission', completed: false },
      { text: 'Starting review', completed: false }
    ]);

    const uploadFormData = new FormData();
    uploadFormData.append('file', selectedFile);
    uploadFormData.append('uploadToken', uploadToken);
    uploadFormData.append('key', key);
    uploadFormData.append('submissionId', submissionId);

    const uploadResponse = await fetch(uploadUrl, {
      method: 'POST',
      body: uploadFormData
    });

    if (!uploadResponse.ok) {
      const error = await uploadResponse.json();
      throw new Error(error.error || 'Failed to upload PDF');
    }

    const { downloadUrl } = await uploadResponse.json();

    // Step 3: Trigger review workflow
    showStatus('Creating submission...', [
      { text: 'Preparing upload', completed: true },
      { text: 'Uploading PDF', completed: true },
      { text: 'Creating submission', active: true },
      { text: 'Starting review', completed: false }
    ]);

    const triggerResponse = await fetch(`${PDF_WORKER_URL}/trigger-review`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        submissionId,
        metadata,
        pdfUrl: downloadUrl,
        githubToken: token
      })
    });

    if (!triggerResponse.ok) {
      const error = await triggerResponse.json();
      throw new Error(error.error || 'Failed to create submission');
    }

    const { issueNumber, issueUrl } = await triggerResponse.json();

    // Step 4: Success!
    showStatus('Review started!', [
      { text: 'Preparing upload', completed: true },
      { text: 'Uploading PDF', completed: true },
      { text: 'Creating submission', completed: true },
      { text: 'Starting review', completed: true }
    ]);

    // Store submission locally
    const submissions = JSON.parse(localStorage.getItem('submissions') || '[]');
    submissions.push({
      id: submissionId,
      title: metadata.title,
      status: 'processing',
      submitted_at: new Date().toISOString(),
      issue_number: issueNumber,
      issue_url: issueUrl
    });
    localStorage.setItem('submissions', JSON.stringify(submissions));

    // Show success
    setTimeout(() => {
      document.getElementById('submission-status').style.display = 'none';
      document.getElementById('submission-success').style.display = 'block';
      document.getElementById('submission-id').textContent = submissionId;
    }, 1500);

  } catch (error) {
    console.error('Submission error:', error);
    alert(`Submission failed: ${error.message}\n\nPlease try again or use the fallback GitHub upload method.`);

    // Show fallback option
    showFallbackOption(submissionId, metadata);
  }
}

function showFallbackOption(submissionId, metadata) {
  // Fallback to original GitHub issue method
  const issueBody = `## New Paper Submission

**Submission ID:** ${submissionId}
**Title:** ${metadata.title}
**Type:** ${metadata.paper_type}
**Authors:** ${metadata.authors.map(a => a.name).join(', ')}

### Abstract
${metadata.abstract}

### Keywords
${metadata.keywords.join(', ')}

${metadata.code_url ? `**Code:** ${metadata.code_url}` : ''}
${metadata.data_url ? `**Data:** ${metadata.data_url}` : ''}

---

## ATTACH YOUR PDF BELOW

**Drag and drop your PDF file into this text area before submitting.**

---
*Submitted via Agentic Journal Portal (Fallback)*
`;

  const issueTitle = encodeURIComponent(`[Submission] ${metadata.title}`);
  const issueBodyEncoded = encodeURIComponent(issueBody);
  const labels = encodeURIComponent(`submission,${metadata.paper_type}`);

  const githubIssueUrl = `https://github.com/${REPO_OWNER}/${REPO_NAME}/issues/new?title=${issueTitle}&body=${issueBodyEncoded}&labels=${labels}`;

  document.getElementById('status-message').innerHTML = `
    <h3>Upload Service Unavailable</h3>
    <p>Don't worry! You can still submit using GitHub.</p>
    <p><strong>Click below and attach your PDF to the GitHub issue:</strong></p>
    <br>
    <a href="${githubIssueUrl}" target="_blank" class="btn btn-primary btn-large">
      Submit via GitHub
    </a>
    <br><br>
    <p style="font-size: 0.9rem; color: #666;">Your submission ID: <strong>${submissionId}</strong></p>
  `;
}
</script>
